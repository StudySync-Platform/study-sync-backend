"""
Input for creating a comment or reply on a post.
"""
input CreatePostCommentInput {
    post_id: ID!
    parent_id: ID
    content: String!
    media_urls: [String!]
}

"""
Input for updating a comment.
Only provided fields will be updated.
"""
input UpdatePostCommentInput {
    content: String
    media_urls: [String!]
}

type PostComment {
    id: ID!
    commenter_id: ID!
    post_id: ID!
    parent_id: ID
    content: String!
    media_urls: [String!]
    created_at: DateTime!
    updated_at: DateTime!

    commenter: User! @belongsTo
    post: Post! @belongsTo
    parent: PostComment @belongsTo
    children: [PostComment!]! @hasMany
}

type Query {
    comments(
        post_id: ID @where(key: "post_id")
        onlyTopLevel: Boolean @whereNull(key: "parent_id")
        orderBy: [OrderByClause!] @orderBy
    ): [PostComment!]! @paginate(type: "PAGINATOR", defaultCount: 10)
}


extend type Mutation {
    createPostComment(
        input: CreatePostCommentInput!
    ): PostComment
    @guard
    @validator(class: "App\\GraphQL\\Validators\\Post\\CreatePostCommentValidator")
    @field(resolver: "App\\GraphQL\\Mutations\\Post\\CreatePostComment")
    
    updatePostComment(
        id: ID!
        input: UpdatePostCommentInput!
    ): PostComment!
    @guard
    @can(ability: "update", find: "id")
    @field(resolver: "App\\GraphQL\\Mutations\\Post\\UpdatePostComment")
    
    deletePostComment(id: ID!): PostComment!
    @guard
    @can(ability: "delete", find: "id")
    @field(resolver: "App\\GraphQL\\Mutations\\Post\\DeletePostComment")
}
