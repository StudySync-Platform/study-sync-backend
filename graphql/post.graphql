# -------------------------------
# Enums
# -------------------------------

"Visibility enum mirrors App\\Enums\\Visibility"
enum Visibility {
  public
  private
  room_only
  friends
  custom
}

enum SortOrder {
  ASC
  DESC
}

# -------------------------------
# Inputs
# -------------------------------

"""
Input for creating a Post.
- visibility must match the PHP enum App\\Enums\\Visibility
- type is a free-form string like 'text', 'image', 'poll', etc.
"""
input CreatePostInput {
  room_id: ID
  content: String!
  media_urls: [String!]
  visibility: Visibility!
  type: String!
}

input OrderByClause {
  column: String!
  order: SortOrder = ASC
}

# -------------------------------
# Types
# -------------------------------

type PostComment {
  id: ID!
  post_id: ID!
  author_id: ID!
  content: String!
  created_at: DateTime!
  updated_at: DateTime!
}

type PostReaction {
  id: ID!
  post_id: ID!
  user_id: ID!
  type: String! # e.g., "like", "love", etc.
  created_at: DateTime!
  updated_at: DateTime!
}

type Post {
  id: ID!
  author_id: ID!
  room_id: ID
  content: String!
  media_urls: [String!]
  visibility: Visibility!
  type: String!
  created_at: DateTime!
  updated_at: DateTime!

  author: User @belongsTo
  room: Room @belongsTo
  comments: [PostComment!]! @hasMany
  comments_count: Int! @count(relation: "comments")
  reactions: [PostReaction!]! @hasMany
  reactions_count: Int! @count(relation: "reactions")
}

# -------------------------------
# Queries
# -------------------------------

extend type Query {
  posts(
    first: Int
    page: Int
    author_id: ID @where(key: "author_id")
    room_id: ID @where(key: "room_id")
    visibility: Visibility @where(key: "visibility")
    orderBy: [OrderByClause!] @orderBy
  ): [Post!]!
    @paginate(type: "PAGINATOR", model: "App\\Models\\Post")
}

# -------------------------------
# Mutations
# -------------------------------

type Mutation {
  createPost(input: CreatePostInput!): Post!
    @field(resolver: "App\\GraphQL\\Mutations\\Post\\CreatePost")
}
